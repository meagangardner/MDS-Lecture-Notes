

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lecture 5 - Tidy control flow in R &#8212; DSCI 523 Programming for Data Manipulation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture-notes/05-tidy-control-flow';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 6: Functions and testing" href="06-lecture-functions-and-testing.html" />
    <link rel="prev" title="Lecture 4 - Combining data frames (binds and joins) &amp; base R control flow" href="04-two-table-joins-and-base-control-flow.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/hex_sticker_small.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/hex_sticker_small.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    DSCI 523: Programming for Data Manipulation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-intro-to-r-via-tidyverse.html">Lecture 1 -  Introduction to R via the tidyverse</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-data-types-and-operators.html">Lecture 2 -  Key datatypes &amp; operators in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-dates-strings-and-factors.html">Lecture 3 -  dates &amp; times, strings,  as well as factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-two-table-joins-and-base-control-flow.html">Lecture 4 -  Combining data frames (binds and joins) &amp; base R control flow</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 5 -  Tidy control flow in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-lecture-functions-and-testing.html">Lecture 6: Functions and testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-mapping-and-nested-data-frames.html">Lecture 7: Mapping and nested data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-lecture-tidy-evaluation.html">Lecture 8: Tidy evaluation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.ubc.ca/mds-2023-24/DSCI_523_r-prog_students" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.ubc.ca/mds-2023-24/DSCI_523_r-prog_students/issues/new?title=Issue%20on%20page%20%2Flecture-notes/05-tidy-control-flow.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lecture-notes/05-tidy-control-flow.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 5 -  Tidy control flow in R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture learning objectives:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-or-remove-specific-values">Change or remove specific values</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selectively-change-a-values">Selectively change a values</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#selectively-change-two-or-more-values-with-case-when">Selectively change two or more values with <code class="docutils literal notranslate"><span class="pre">case_when</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-rows-where-a-specific-column-holds-nas">Removing rows where a specific column holds NAs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-all-rows-where-there-is-a-na-in-any-column">Removing all rows where there is a NA in any column</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterate-over-groups-of-rows">Iterate over groups of rows</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summarise-calculates-summaries-over-rows"><code class="docutils literal notranslate"><span class="pre">summarise</span></code> calculates summaries over rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iteration-with-group-by-summarise">Iteration with <code class="docutils literal notranslate"><span class="pre">group_by</span></code> + <code class="docutils literal notranslate"><span class="pre">summarise</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#watch-those-na-s">Watch those NA’s!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grouped-mutate">Grouped mutate</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purrring-instead-of-for-loops">Purrring instead of for loops</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purrr-map-functions">{purrr} <code class="docutils literal notranslate"><span class="pre">map_*</span></code> functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-have-programmed-in-r-before">If you have programmed in R before</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-columns-of-a-data-frame">Iterating over columns of a data frame</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#can-we-write-this-as-a-function">Can we write this as a function?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionals">Functionals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-can-you-do-with-functionals">What can you do with functionals?</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#of-course-someone-has-to-write-for-loops"><em>Of course someone has to write for loops</em></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#it-doesn-t-have-to-be-you"><em>It doesn’t have to be you</em></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-purrr-map-family-of-functions">The <code class="docutils literal notranslate"><span class="pre">purrr::map*</span></code> family of functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-start-at-the-beginning-with-the-most-general-purrr-function-map">Let’s start at the beginning with the most general <code class="docutils literal notranslate"><span class="pre">purrr</span></code> function: <code class="docutils literal notranslate"><span class="pre">map</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purrr-map-test-drive"><code class="docutils literal notranslate"><span class="pre">purrr::map</span></code> test drive</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-our-data-frame-had-missing-values">What if our data frame had missing values?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attributions">Attributions</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="lecture-5-tidy-control-flow-in-r">
<h1>Lecture 5 -  Tidy control flow in R<a class="headerlink" href="#lecture-5-tidy-control-flow-in-r" title="Permalink to this heading">#</a></h1>
<section id="lecture-learning-objectives">
<h2>Lecture learning objectives:<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this heading">#</a></h2>
<p>By the end of this lecture and worksheet 5, students should be able to:</p>
<ul class="simple">
<li><p>Explain what a grouped data frame is, and how it can be used</p></li>
<li><p>Use {dplyr}’s <code class="docutils literal notranslate"><span class="pre">group_by</span></code> + <code class="docutils literal notranslate"><span class="pre">summarize</span></code> to perform the split-apply-combine approach in R to iterate over and summarize data by groups</p></li>
<li><p>Identify missing and erroneous values and manage them by removing (via {dplyr}’s <code class="docutils literal notranslate"><span class="pre">filter</span></code>) or replacing (using {dplyr}’s <code class="docutils literal notranslate"><span class="pre">mutate</span></code> + <code class="docutils literal notranslate"><span class="pre">case_when</span></code>)</p></li>
<li><p>Identify where in R code a commonly used functional, a {purrr}’s <code class="docutils literal notranslate"><span class="pre">map*</span></code> function, could be used in place of for loops and write code to do this</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.matrix.max.rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Attaching core tidyverse packages</span> ───────────────────────────────────────────── tidyverse 2.0.0 ──
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr    </span> 1.1.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr    </span> 2.1.4
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats  </span> 1.0.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr  </span> 1.5.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2  </span> 3.4.3     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble   </span> 3.2.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">lubridate</span> 1.9.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr    </span> 1.3.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr    </span> 1.0.2     
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Conflicts</span> ─────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
<span class=" -Color -Color-Cyan">ℹ</span> Use the conflicted package (<span class=" -Color -Color-Blue">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors
</pre></div>
</div>
</div>
</div>
</section>
<section id="change-or-remove-specific-values">
<h2>Change or remove specific values<a class="headerlink" href="#change-or-remove-specific-values" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Sometimes we’d like to selectively change values, we can do this using control flow within <code class="docutils literal notranslate"><span class="pre">mutate</span></code></p></li>
<li><p>A related task is removing rows where there are NAs, either in a specified column or across the whole data frame or tibble</p></li>
</ul>
<section id="selectively-change-a-values">
<h3>Selectively change a values<a class="headerlink" href="#selectively-change-a-values" title="Permalink to this heading">#</a></h3>
<p>What if we want to programatically change certain values? For example, update the country name “Cambodia” to its official English name, “Kingdom of Cambodia”?</p>
<p>If we want to change one or more (but not all things) in a column, one function we can use is <code class="docutils literal notranslate"><span class="pre">case_when</span></code> inside a <code class="docutils literal notranslate"><span class="pre">mutate</span></code> call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gapminder</span> <span class="o">%&gt;%</span> 
    <span class="n">mutate</span><span class="p">(</span><span class="n">country</span> <span class="o">=</span> <span class="n">case_when</span><span class="p">(</span><span class="n">country</span> <span class="o">==</span> <span class="s2">&quot;Cambodia&quot;</span> <span class="o">~</span> <span class="s2">&quot;Kingdom of Cambodia&quot;</span><span class="p">,</span>
                            <span class="n">TRUE</span> <span class="o">~</span> <span class="n">country</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Error: Problem with `mutate()` input `country`.
✖ must be a character vector, not a `factor` object.
ℹ Input `country` is `case_when(...)`.
Traceback:

1. gapminder %&gt;% mutate(country = case_when(country == &quot;Cambodia&quot; ~ 
 .     &quot;Kingdom of Cambodia&quot;, TRUE ~ country))
2. withVisible(eval(quote(`_fseq`(`_lhs`)), env, env))
3. eval(quote(`_fseq`(`_lhs`)), env, env)
4. eval(quote(`_fseq`(`_lhs`)), env
...
</pre></div>
</div>
<p>Ah! This doesn’t work? What is going on here? Let’s look at the structure of <code class="docutils literal notranslate"><span class="pre">gapminder</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tibble [1,704 × 6] (S3: tbl_df/tbl/data.frame)
 $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
 $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">country</span></code> (and <code class="docutils literal notranslate"><span class="pre">continent</span></code>) are factors! Let’s change these to character vectors so we can manipulate the character values they hold. We’ll make a new tibble named <code class="docutils literal notranslate"><span class="pre">gap</span></code> to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
<span class="w">          </span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">continent</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>OK, now let’s try that conditional <code class="docutils literal notranslate"><span class="pre">mutate</span></code> again!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Cambodia&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Kingdom of Cambodia&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">))</span>
<span class="n">gap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1704 × 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>Asia</td><td>1952</td><td>28.801</td><td> 8425333</td><td>779.4453</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1957</td><td>30.332</td><td> 9240934</td><td>820.8530</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1962</td><td>31.997</td><td>10267083</td><td>853.1007</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1967</td><td>34.020</td><td>11537966</td><td>836.1971</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1972</td><td>36.088</td><td>13079460</td><td>739.9811</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Zimbabwe</td><td>Africa</td><td>1987</td><td>62.351</td><td> 9216418</td><td>706.1573</td></tr>
	<tr><td>Zimbabwe</td><td>Africa</td><td>1992</td><td>60.377</td><td>10704340</td><td>693.4208</td></tr>
	<tr><td>Zimbabwe</td><td>Africa</td><td>1997</td><td>46.809</td><td>11404948</td><td>792.4500</td></tr>
	<tr><td>Zimbabwe</td><td>Africa</td><td>2002</td><td>39.989</td><td>11926563</td><td>672.0386</td></tr>
	<tr><td>Zimbabwe</td><td>Africa</td><td>2007</td><td>43.487</td><td>12311143</td><td>469.7093</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Did it work?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gap</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Kingdom of Cambodia&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 12 × 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1952</td><td>39.417</td><td>4693836</td><td>368.4693</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1957</td><td>41.366</td><td>5322536</td><td>434.0383</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1962</td><td>43.415</td><td>6083619</td><td>496.9136</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1967</td><td>45.415</td><td>6960067</td><td>523.4323</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1972</td><td>40.317</td><td>7450606</td><td>421.6240</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1987</td><td>53.914</td><td> 8371791</td><td> 683.8956</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1992</td><td>55.803</td><td>10150094</td><td> 682.3032</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>1997</td><td>56.534</td><td>11782962</td><td> 734.2852</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>2002</td><td>56.752</td><td>12926707</td><td> 896.2260</td></tr>
	<tr><td>Kingdom of Cambodia</td><td>Asia</td><td>2007</td><td>59.723</td><td>14131858</td><td>1713.7787</td></tr>
</tbody>
</table>
</div></div>
</div>
<section id="selectively-change-two-or-more-values-with-case-when">
<h4>Selectively change two or more values with <code class="docutils literal notranslate"><span class="pre">case_when</span></code><a class="headerlink" href="#selectively-change-two-or-more-values-with-case-when" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">case_when</span></code> will also let us easily modify &gt; 2 cases. What if, for example, we wanted to change the continents from their English name to their French name?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">french_contients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Asia&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Asie&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Europe&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;L&#39;Europe&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Africa&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Afrique&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Americas&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;les amériques&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Oceania&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Océanie&quot;</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">french_contients</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>Asie</td><td>1952</td><td>28.801</td><td> 8425333</td><td>779.4453</td></tr>
	<tr><td>Afghanistan</td><td>Asie</td><td>1957</td><td>30.332</td><td> 9240934</td><td>820.8530</td></tr>
	<tr><td>Afghanistan</td><td>Asie</td><td>1962</td><td>31.997</td><td>10267083</td><td>853.1007</td></tr>
	<tr><td>Afghanistan</td><td>Asie</td><td>1967</td><td>34.020</td><td>11537966</td><td>836.1971</td></tr>
	<tr><td>Afghanistan</td><td>Asie</td><td>1972</td><td>36.088</td><td>13079460</td><td>739.9811</td></tr>
	<tr><td>Afghanistan</td><td>Asie</td><td>1977</td><td>38.438</td><td>14880372</td><td>786.1134</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>What if we don’t want to change Asia?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">french_contients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="c1">#continent == &quot;Asia&quot; ~ &quot;Asie&quot;, </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Europe&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;L&#39;Europe&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Africa&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Afrique&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Americas&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;les amériques&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Oceania&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Océanie&quot;</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">french_contients</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>NA</td><td>1952</td><td>28.801</td><td> 8425333</td><td>779.4453</td></tr>
	<tr><td>Afghanistan</td><td>NA</td><td>1957</td><td>30.332</td><td> 9240934</td><td>820.8530</td></tr>
	<tr><td>Afghanistan</td><td>NA</td><td>1962</td><td>31.997</td><td>10267083</td><td>853.1007</td></tr>
	<tr><td>Afghanistan</td><td>NA</td><td>1967</td><td>34.020</td><td>11537966</td><td>836.1971</td></tr>
	<tr><td>Afghanistan</td><td>NA</td><td>1972</td><td>36.088</td><td>13079460</td><td>739.9811</td></tr>
	<tr><td>Afghanistan</td><td>NA</td><td>1977</td><td>38.438</td><td>14880372</td><td>786.1134</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Uh oh, now Asia is NA?? We need to say <code class="docutils literal notranslate"><span class="pre">TRUE</span> <span class="pre">~</span> <span class="pre">column_name</span></code> to tell R to not put in NA’s in the non-specified class, but instead leave the values that were already there:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">french_contients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="c1">#continent == &quot;Asia&quot; ~ &quot;Asie&quot;, </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Europe&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;L&#39;Europe&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Africa&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Afrique&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Americas&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;les amériques&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Oceania&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Océanie&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">continent</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">french_contients</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>Asia</td><td>1952</td><td>28.801</td><td> 8425333</td><td>779.4453</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1957</td><td>30.332</td><td> 9240934</td><td>820.8530</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1962</td><td>31.997</td><td>10267083</td><td>853.1007</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1967</td><td>34.020</td><td>11537966</td><td>836.1971</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1972</td><td>36.088</td><td>13079460</td><td>739.9811</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1977</td><td>38.438</td><td>14880372</td><td>786.1134</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="removing-rows-where-a-specific-column-holds-nas">
<h3>Removing rows where a specific column holds NAs<a class="headerlink" href="#removing-rows-where-a-specific-column-holds-nas" title="Permalink to this heading">#</a></h3>
<p>Here, we’d like to remove the rows where the column <code class="docutils literal notranslate"><span class="pre">x</span></code> is <code class="docutils literal notranslate"><span class="pre">NA</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td> 3</td><td>z </td></tr>
	<tr><td> 1</td><td>a </td></tr>
	<tr><td> 2</td><td>NA</td></tr>
	<tr><td>NA</td><td>b </td></tr>
</tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">drop_na</span></code> is the tidyverse function we can use to do this.</p>
<p>In this case we pass the column for which we would like to use to drive the removal of rows (based on the presence of NAs in that row):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">drop_na</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>3</td><td>z</td></tr>
	<tr><td>1</td><td>a</td></tr>
</tbody>
</table>
</div></div>
</div>
<section id="removing-all-rows-where-there-is-a-na-in-any-column">
<h4>Removing all rows where there is a NA in any column<a class="headerlink" href="#removing-all-rows-where-there-is-a-na-in-any-column" title="Permalink to this heading">#</a></h4>
<p>If no arguments are given to <code class="docutils literal notranslate"><span class="pre">drop_na</span></code>, then all rows with NAs will be dropped:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">drop_na</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>3</td><td>z</td></tr>
	<tr><td>1</td><td>a</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>
<section id="iterate-over-groups-of-rows">
<h2>Iterate over groups of rows<a class="headerlink" href="#iterate-over-groups-of-rows" title="Permalink to this heading">#</a></h2>
<section id="summarise-calculates-summaries-over-rows">
<h3><code class="docutils literal notranslate"><span class="pre">summarise</span></code> calculates summaries over rows<a class="headerlink" href="#summarise-calculates-summaries-over-rows" title="Permalink to this heading">#</a></h3>
<p>Examples might be calculating the mean horsepower and mean miles per gallon of cars in the <code class="docutils literal notranslate"><span class="pre">mtcars</span></code> data set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate mean hp and mpg for all cars</span>
<span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">summarise</span><span class="p">(</span><span class="n">mean_hp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">hp</span><span class="p">),</span>
<span class="w">             </span><span class="n">mean_mpg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">mpg</span><span class="p">),</span>
<span class="w">             </span><span class="n">sum_hp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">hp</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 1 × 3</caption>
<thead>
	<tr><th scope=col>mean_hp</th><th scope=col>mean_mpg</th><th scope=col>sum_hp</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>146.6875</td><td>20.09062</td><td>4694</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="iteration-with-group-by-summarise">
<h3>Iteration with <code class="docutils literal notranslate"><span class="pre">group_by</span></code> + <code class="docutils literal notranslate"><span class="pre">summarise</span></code><a class="headerlink" href="#iteration-with-group-by-summarise" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Useful when you want to do something repeatedly to a group of rows</p></li>
<li><p>An example, say we want to calculate the average life expectancy (<code class="docutils literal notranslate"><span class="pre">lifeExp</span></code>) for each continent from the gapminder data set</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the average life expectancy for each continent</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">summarise</span><span class="p">(</span><span class="n">mean_life_exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 2</caption>
<thead>
	<tr><th scope=col>continent</th><th scope=col>mean_life_exp</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Africa  </td><td>48.86533</td></tr>
	<tr><td>Americas</td><td>64.65874</td></tr>
	<tr><td>Asia    </td><td>60.06490</td></tr>
	<tr><td>Europe  </td><td>71.90369</td></tr>
	<tr><td>Oceania </td><td>74.32621</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can also <code class="docutils literal notranslate"><span class="pre">group_by</span></code> multiple columns, for example what if we want to know the mean life expectancy for each continent and each year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the mean life expectancy for each continent and each year</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">summarise</span><span class="p">(</span><span class="n">mean_life_exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;continent&#39;. You can override using the `.groups` argument.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A grouped_df: 60 × 3</caption>
<thead>
	<tr><th scope=col>continent</th><th scope=col>year</th><th scope=col>mean_life_exp</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Africa</td><td>1952</td><td>39.13550</td></tr>
	<tr><td>Africa</td><td>1957</td><td>41.26635</td></tr>
	<tr><td>Africa</td><td>1962</td><td>43.31944</td></tr>
	<tr><td>Africa</td><td>1967</td><td>45.33454</td></tr>
	<tr><td>Africa</td><td>1972</td><td>47.45094</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Oceania</td><td>1987</td><td>75.3200</td></tr>
	<tr><td>Oceania</td><td>1992</td><td>76.9450</td></tr>
	<tr><td>Oceania</td><td>1997</td><td>78.1900</td></tr>
	<tr><td>Oceania</td><td>2002</td><td>79.7400</td></tr>
	<tr><td>Oceania</td><td>2007</td><td>80.7195</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="watch-those-na-s">
<h3>Watch those NA’s!<a class="headerlink" href="#watch-those-na-s" title="Permalink to this heading">#</a></h3>
<p>Calculate the maximum beak length for each of the Penguin species in the {palmerpenguins} <code class="docutils literal notranslate"><span class="pre">penguins</span></code> dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">palmerpenguins</span><span class="p">)</span>
<span class="n">penguins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 344 × 8</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>island</th><th scope=col>bill_length_mm</th><th scope=col>bill_depth_mm</th><th scope=col>flipper_length_mm</th><th scope=col>body_mass_g</th><th scope=col>sex</th><th scope=col>year</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie</td><td>Torgersen</td><td>39.1</td><td>18.7</td><td>181</td><td>3750</td><td>male  </td><td>2007</td></tr>
	<tr><td>Adelie</td><td>Torgersen</td><td>39.5</td><td>17.4</td><td>186</td><td>3800</td><td>female</td><td>2007</td></tr>
	<tr><td>Adelie</td><td>Torgersen</td><td>40.3</td><td>18.0</td><td>195</td><td>3250</td><td>female</td><td>2007</td></tr>
	<tr><td>Adelie</td><td>Torgersen</td><td>  NA</td><td>  NA</td><td> NA</td><td>  NA</td><td>NA    </td><td>2007</td></tr>
	<tr><td>Adelie</td><td>Torgersen</td><td>36.7</td><td>19.3</td><td>193</td><td>3450</td><td>female</td><td>2007</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Chinstrap</td><td>Dream</td><td>55.8</td><td>19.8</td><td>207</td><td>4000</td><td>male  </td><td>2009</td></tr>
	<tr><td>Chinstrap</td><td>Dream</td><td>43.5</td><td>18.1</td><td>202</td><td>3400</td><td>female</td><td>2009</td></tr>
	<tr><td>Chinstrap</td><td>Dream</td><td>49.6</td><td>18.2</td><td>193</td><td>3775</td><td>male  </td><td>2009</td></tr>
	<tr><td>Chinstrap</td><td>Dream</td><td>50.8</td><td>19.0</td><td>210</td><td>4100</td><td>male  </td><td>2009</td></tr>
	<tr><td>Chinstrap</td><td>Dream</td><td>50.2</td><td>18.7</td><td>198</td><td>3775</td><td>female</td><td>2009</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">summarise</span><span class="p">(</span><span class="n">max_bill_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>max_bill_length</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>NA</td></tr>
	<tr><td>Chinstrap</td><td>58</td></tr>
	<tr><td>Gentoo   </td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Huh???</p>
<p>By default, summary statistics functions in R return <code class="docutils literal notranslate"><span class="pre">NA</span></code> if there are any <code class="docutils literal notranslate"><span class="pre">NA</span></code> observations in the data… This is often not ideal, what we’d like would be for R to just ignore the <code class="docutils literal notranslate"><span class="pre">NA</span></code>’s and kindly return us the statistic we asked for. We can specify this by setting the <code class="docutils literal notranslate"><span class="pre">na.rm</span></code> argument to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">summarise</span><span class="p">(</span><span class="n">max_bill_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>max_bill_length</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>46.0</td></tr>
	<tr><td>Chinstrap</td><td>58.0</td></tr>
	<tr><td>Gentoo   </td><td>59.6</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="grouped-mutate">
<h3>Grouped mutate<a class="headerlink" href="#grouped-mutate" title="Permalink to this heading">#</a></h3>
<p>Sometimes you don’t want to collapse the n rows for each group into one row. You want to keep your groups, but compute within them.</p>
<p>Let’s make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. We group by <code class="docutils literal notranslate"><span class="pre">country</span></code> and use <code class="docutils literal notranslate"><span class="pre">mutate</span></code> to make a new variable. The <code class="docutils literal notranslate"><span class="pre">first</span></code> function extracts the first value from a vector. Notice that <code class="docutils literal notranslate"><span class="pre">first</span></code> is operating on the vector of life expectancies within each country group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate life expectancy gained (or lost) relative to 1952</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="n">life_exp_gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A grouped_df: 6 × 7</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>continent</th><th scope=col>year</th><th scope=col>lifeExp</th><th scope=col>pop</th><th scope=col>gdpPercap</th><th scope=col>life_exp_gain</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>Asia</td><td>1952</td><td>28.801</td><td> 8425333</td><td>779.4453</td><td>0.000</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1957</td><td>30.332</td><td> 9240934</td><td>820.8530</td><td>1.531</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1962</td><td>31.997</td><td>10267083</td><td>853.1007</td><td>3.196</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1967</td><td>34.020</td><td>11537966</td><td>836.1971</td><td>5.219</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1972</td><td>36.088</td><td>13079460</td><td>739.9811</td><td>7.287</td></tr>
	<tr><td>Afghanistan</td><td>Asia</td><td>1977</td><td>38.438</td><td>14880372</td><td>786.1134</td><td>9.637</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="purrring-instead-of-for-loops">
<h2>Purrring instead of for loops<a class="headerlink" href="#purrring-instead-of-for-loops" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="https://ih1.redbubble.net/image.329884292.2339/sticker,375x360-bg,ffffff.u1.png" /></p>
<p>https://purrr.tidyverse.org/</p>
<section id="purrr-map-functions">
<h3>{purrr} <code class="docutils literal notranslate"><span class="pre">map_*</span></code> functions<a class="headerlink" href="#purrr-map-functions" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>alternative to <code class="docutils literal notranslate"><span class="pre">for</span></code> loops that help you make less syntax errors</p></li>
</ul>
</section>
<section id="if-you-have-programmed-in-r-before">
<h3>If you have programmed in R before<a class="headerlink" href="#if-you-have-programmed-in-r-before" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">purrr</span></code> is an alternative to “apply” functions</p>
<p><code class="docutils literal notranslate"><span class="pre">purrr::map()</span></code> ≈ <code class="docutils literal notranslate"><span class="pre">base::lapply()</span></code></p>
</section>
<section id="iterating-over-columns-of-a-data-frame">
<h3>Iterating over columns of a data frame<a class="headerlink" href="#iterating-over-columns-of-a-data-frame" title="Permalink to this heading">#</a></h3>
<p>Say, for example we wanted to calculate the median for each column in the <code class="docutils literal notranslate"><span class="pre">mtcars</span></code> data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 11</caption>
<thead>
	<tr><th></th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>Mazda RX4</th><td>21.0</td><td>6</td><td>160</td><td>110</td><td>3.90</td><td>2.620</td><td>16.46</td><td>0</td><td>1</td><td>4</td><td>4</td></tr>
	<tr><th scope=row>Mazda RX4 Wag</th><td>21.0</td><td>6</td><td>160</td><td>110</td><td>3.90</td><td>2.875</td><td>17.02</td><td>0</td><td>1</td><td>4</td><td>4</td></tr>
	<tr><th scope=row>Datsun 710</th><td>22.8</td><td>4</td><td>108</td><td> 93</td><td>3.85</td><td>2.320</td><td>18.61</td><td>1</td><td>1</td><td>4</td><td>1</td></tr>
	<tr><th scope=row>Hornet 4 Drive</th><td>21.4</td><td>6</td><td>258</td><td>110</td><td>3.08</td><td>3.215</td><td>19.44</td><td>1</td><td>0</td><td>3</td><td>1</td></tr>
	<tr><th scope=row>Hornet Sportabout</th><td>18.7</td><td>8</td><td>360</td><td>175</td><td>3.15</td><td>3.440</td><td>17.02</td><td>0</td><td>0</td><td>3</td><td>2</td></tr>
	<tr><th scope=row>Valiant</th><td>18.1</td><td>6</td><td>225</td><td>105</td><td>2.76</td><td>3.460</td><td>20.22</td><td>1</td><td>0</td><td>3</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">medians</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">medians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>OK, then next we want to calculate the mean for all of the columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>OK, and then the variance…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">variances</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">variances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>This is getting a little repetitive… What are we repeating?</p>
<section id="can-we-write-this-as-a-function">
<h4>Can we write this as a function?<a class="headerlink" href="#can-we-write-this-as-a-function" title="Permalink to this heading">#</a></h4>
<p>Given that functions are objects in R, this seems reasonable!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">medians</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">medians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>This is essentially the guts of <code class="docutils literal notranslate"><span class="pre">purrr::map_dbl</span></code>. The only difference is that is coded in C and the use of <code class="docutils literal notranslate"><span class="pre">...</span></code> for additional arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mds_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">out</span>
<span class="p">}</span>
<span class="nf">mds_map</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>10.4</li><li>4</li><li>71.1</li><li>52</li><li>2.76</li><li>1.513</li><li>14.5</li><li>0</li><li>0</li><li>3</li><li>1</li></ol>
</div></div>
</div>
</section>
</section>
<section id="functionals">
<h3>Functionals<a class="headerlink" href="#functionals" title="Permalink to this heading">#</a></h3>
<p>We have just written what is called a functional.</p>
<p>A functional is a function that takes a function (and other things) as an input and returns a vector as output.</p>
<p>R has several other functionals outside of <code class="docutils literal notranslate"><span class="pre">purrr</span></code> that you might have already encountered: <code class="docutils literal notranslate"><span class="pre">lapply</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">tapply</span></code>, <code class="docutils literal notranslate"><span class="pre">integrate</span></code> or <code class="docutils literal notranslate"><span class="pre">optim</span></code>.</p>
</section>
<section id="what-can-you-do-with-functionals">
<h3>What can you do with functionals?<a class="headerlink" href="#what-can-you-do-with-functionals" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Common use is as an alternative to for loops</p></li>
</ul>
<ul class="simple">
<li><p>For loops are actually quite effective for iteration, and efficient when used, however it is easy to make mistakes when setting them up as you have to:</p>
<ul>
<li><p>pre-allocate space for the output</p></li>
<li><p>iterate over the thing the right amount of times</p></li>
<li><p>properly use the iteration index</p></li>
</ul>
</li>
</ul>
<section id="of-course-someone-has-to-write-for-loops">
<h4><em>Of course someone has to write for loops</em><a class="headerlink" href="#of-course-someone-has-to-write-for-loops" title="Permalink to this heading">#</a></h4>
</section>
<section id="it-doesn-t-have-to-be-you">
<h4><em>It doesn’t have to be you</em><a class="headerlink" href="#it-doesn-t-have-to-be-you" title="Permalink to this heading">#</a></h4>
<p>– <em>Jenny Bryan, Software Engineer at RStudio and UBC MDS Founder</em></p>
</section>
</section>
<section id="the-purrr-map-family-of-functions">
<h3>The <code class="docutils literal notranslate"><span class="pre">purrr::map*</span></code> family of functions<a class="headerlink" href="#the-purrr-map-family-of-functions" title="Permalink to this heading">#</a></h3>
<a class="reference internal image-reference" href="../_images/map_family.png"><img alt="../_images/map_family.png" src="../_images/map_family.png" style="width: 900px;" /></a>
<p><em>Source: <a class="reference external" href="https://adv-r.hadley.nz/">Advanced R</a> by Hadley Wickham</em></p>
</section>
<section id="let-s-start-at-the-beginning-with-the-most-general-purrr-function-map">
<h3>Let’s start at the beginning with the most general <code class="docutils literal notranslate"><span class="pre">purrr</span></code> function: <code class="docutils literal notranslate"><span class="pre">map</span></code><a class="headerlink" href="#let-s-start-at-the-beginning-with-the-most-general-purrr-function-map" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Above reads as: <code class="docutils literal notranslate"><span class="pre">for</span></code> every element of <code class="docutils literal notranslate"><span class="pre">.x</span></code> apply <code class="docutils literal notranslate"><span class="pre">.f</span></code></p>
<p>and can be pictured as:</p>
<a class="reference internal image-reference" href="https://d33wubrfki0l68.cloudfront.net/12f6af8404d9723dff9cc665028a35f07759299d/d0d9a/diagrams/functionals/map-list.png"><img alt="https://d33wubrfki0l68.cloudfront.net/12f6af8404d9723dff9cc665028a35f07759299d/d0d9a/diagrams/functionals/map-list.png" src="https://d33wubrfki0l68.cloudfront.net/12f6af8404d9723dff9cc665028a35f07759299d/d0d9a/diagrams/functionals/map-list.png" style="width: 500px;" /></a>
<p>Or picture as…</p>
<a class="reference internal image-reference" href="../_images/minis_as_data.png"><img alt="../_images/minis_as_data.png" src="../_images/minis_as_data.png" style="width: 800px;" /></a>
<p><em>Source: <a class="reference external" href="https://speakerdeck.com/jennybc/row-oriented-workflows-in-r-with-the-tidyverse">Row-oriented workflows in R with the tidyverse</a> by Jenny Bryan</em></p>
<a class="reference internal image-reference" href="../_images/minis_map.png"><img alt="../_images/minis_map.png" src="../_images/minis_map.png" style="width: 800px;" /></a>
<p><em>Source: <a class="reference external" href="https://speakerdeck.com/jennybc/row-oriented-workflows-in-r-with-the-tidyverse">Row-oriented workflows in R with the tidyverse</a> by Jenny Bryan</em></p>
</section>
<section id="purrr-map-test-drive">
<h3><code class="docutils literal notranslate"><span class="pre">purrr::map</span></code> test drive<a class="headerlink" href="#purrr-map-test-drive" title="Permalink to this heading">#</a></h3>
<p>Let’s calculate the median of all the columns of the <code class="docutils literal notranslate"><span class="pre">mtcars</span></code> data frame using <code class="docutils literal notranslate"><span class="pre">purrr::map</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span>
<span class="nf">map</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$mpg</dt>
		<dd>19.2</dd>
	<dt>$cyl</dt>
		<dd>6</dd>
	<dt>$disp</dt>
		<dd>196.3</dd>
	<dt>$hp</dt>
		<dd>123</dd>
	<dt>$drat</dt>
		<dd>3.695</dd>
	<dt>$wt</dt>
		<dd>3.325</dd>
	<dt>$qsec</dt>
		<dd>17.71</dd>
	<dt>$vs</dt>
		<dd>0</dd>
	<dt>$am</dt>
		<dd>0</dd>
	<dt>$gear</dt>
		<dd>4</dd>
	<dt>$carb</dt>
		<dd>2</dd>
</dl>
</div></div>
</div>
<p>That looks different from our <code class="docutils literal notranslate"><span class="pre">mds_map</span></code> function! The output is of type list. We can use <code class="docutils literal notranslate"><span class="pre">map_df</span></code> to get a vector of type double:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map_dbl</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>mpg</dt><dd>19.2</dd><dt>cyl</dt><dd>6</dd><dt>disp</dt><dd>196.3</dd><dt>hp</dt><dd>123</dd><dt>drat</dt><dd>3.695</dd><dt>wt</dt><dd>3.325</dd><dt>qsec</dt><dd>17.71</dd><dt>vs</dt><dd>0</dd><dt>am</dt><dd>0</dd><dt>gear</dt><dd>4</dd><dt>carb</dt><dd>2</dd></dl>
</div></div>
</div>
<p>And <code class="docutils literal notranslate"><span class="pre">map_df</span></code> will give us a tibble:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map_df</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 11</caption>
<thead>
	<tr><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>19.2</td><td>6</td><td>196.3</td><td>123</td><td>3.695</td><td>3.325</td><td>17.71</td><td>0</td><td>0</td><td>4</td><td>2</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>So now it’s super efficient and easy to get several summary stats across columns!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map_df</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
<span class="nf">map_df</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="nf">map_df</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>
<span class="nf">map_df</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 11</caption>
<thead>
	<tr><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>19.2</td><td>6</td><td>196.3</td><td>123</td><td>3.695</td><td>3.325</td><td>17.71</td><td>0</td><td>0</td><td>4</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 11</caption>
<thead>
	<tr><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>20.09062</td><td>6.1875</td><td>230.7219</td><td>146.6875</td><td>3.596563</td><td>3.21725</td><td>17.84875</td><td>0.4375</td><td>0.40625</td><td>3.6875</td><td>2.8125</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 11</caption>
<thead>
	<tr><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>33.9</td><td>8</td><td>472</td><td>335</td><td>4.93</td><td>5.424</td><td>22.9</td><td>1</td><td>1</td><td>5</td><td>8</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 11</caption>
<thead>
	<tr><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>hp</th><th scope=col>drat</th><th scope=col>wt</th><th scope=col>qsec</th><th scope=col>vs</th><th scope=col>am</th><th scope=col>gear</th><th scope=col>carb</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>10.4</td><td>4</td><td>71.1</td><td>52</td><td>2.76</td><td>1.513</td><td>14.5</td><td>0</td><td>0</td><td>3</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<section id="what-if-our-data-frame-had-missing-values">
<h4>What if our data frame had missing values?<a class="headerlink" href="#what-if-our-data-frame-had-missing-values" title="Permalink to this heading">#</a></h4>
<p>Let’s make some to see the consequences…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars_NA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span>
<span class="n">mtcars_NA</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>

<span class="nf">map_dbl</span><span class="p">(</span><span class="n">mtcars_NA</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>mpg</dt><dd>&lt;NA&gt;</dd><dt>cyl</dt><dd>6</dd><dt>disp</dt><dd>196.3</dd><dt>hp</dt><dd>123</dd><dt>drat</dt><dd>3.695</dd><dt>wt</dt><dd>3.325</dd><dt>qsec</dt><dd>17.71</dd><dt>vs</dt><dd>0</dd><dt>am</dt><dd>0</dd><dt>gear</dt><dd>4</dd><dt>carb</dt><dd>2</dd></dl>
</div></div>
</div>
<p>How do we tell <code class="docutils literal notranslate"><span class="pre">median</span></code> to ignore NA’s? Using <code class="docutils literal notranslate"><span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>! But how do we add this to our <code class="docutils literal notranslate"><span class="pre">map_dbl</span></code> call?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map_dbl</span><span class="p">(</span><span class="n">mtcars_NA</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>mpg</dt><dd>19.2</dd><dt>cyl</dt><dd>6</dd><dt>disp</dt><dd>196.3</dd><dt>hp</dt><dd>123</dd><dt>drat</dt><dd>3.695</dd><dt>wt</dt><dd>3.325</dd><dt>qsec</dt><dd>17.71</dd><dt>vs</dt><dd>0</dd><dt>am</dt><dd>0</dd><dt>gear</dt><dd>4</dd><dt>carb</dt><dd>2</dd></dl>
</div></div>
</div>
<p>That’s all we will learn of the {purrr} functions for now - however we will meet them again (and learn more about them) next week when we start working with nested data frames.</p>
</section>
</section>
<section id="what-did-we-learn-today">
<h3>What did we learn today?<a class="headerlink" href="#what-did-we-learn-today" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">case_when</span></code> to selectively change values in a data frame (similar to base R <code class="docutils literal notranslate"><span class="pre">if</span></code> statements)</p></li>
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">group_by</span></code> to iterate over groups of rows (similar to <code class="docutils literal notranslate"><span class="pre">for</span></code> loops in base R)</p></li>
<li><p>How to use {purrr} <code class="docutils literal notranslate"><span class="pre">map_*</span></code> functions to iterate over columns (similar to <code class="docutils literal notranslate"><span class="pre">apply</span></code> in base R)</p></li>
</ul>
</section>
<section id="attributions">
<h3>Attributions<a class="headerlink" href="#attributions" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://stat545.com/">Stat 545</a> created by Jenny Bryan</p></li>
<li><p><a class="reference external" href="https://r4ds.had.co.nz/index.html">R for Data Science</a> by Garrett Grolemund &amp; Hadley Wickham</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./lecture-notes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="04-two-table-joins-and-base-control-flow.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 4 -  Combining data frames (binds and joins) &amp; base R control flow</p>
      </div>
    </a>
    <a class="right-next"
       href="06-lecture-functions-and-testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 6: Functions and testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture learning objectives:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-or-remove-specific-values">Change or remove specific values</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selectively-change-a-values">Selectively change a values</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#selectively-change-two-or-more-values-with-case-when">Selectively change two or more values with <code class="docutils literal notranslate"><span class="pre">case_when</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-rows-where-a-specific-column-holds-nas">Removing rows where a specific column holds NAs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-all-rows-where-there-is-a-na-in-any-column">Removing all rows where there is a NA in any column</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterate-over-groups-of-rows">Iterate over groups of rows</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summarise-calculates-summaries-over-rows"><code class="docutils literal notranslate"><span class="pre">summarise</span></code> calculates summaries over rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iteration-with-group-by-summarise">Iteration with <code class="docutils literal notranslate"><span class="pre">group_by</span></code> + <code class="docutils literal notranslate"><span class="pre">summarise</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#watch-those-na-s">Watch those NA’s!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grouped-mutate">Grouped mutate</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purrring-instead-of-for-loops">Purrring instead of for loops</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purrr-map-functions">{purrr} <code class="docutils literal notranslate"><span class="pre">map_*</span></code> functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-have-programmed-in-r-before">If you have programmed in R before</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-columns-of-a-data-frame">Iterating over columns of a data frame</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#can-we-write-this-as-a-function">Can we write this as a function?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionals">Functionals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-can-you-do-with-functionals">What can you do with functionals?</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#of-course-someone-has-to-write-for-loops"><em>Of course someone has to write for loops</em></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#it-doesn-t-have-to-be-you"><em>It doesn’t have to be you</em></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-purrr-map-family-of-functions">The <code class="docutils literal notranslate"><span class="pre">purrr::map*</span></code> family of functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-start-at-the-beginning-with-the-most-general-purrr-function-map">Let’s start at the beginning with the most general <code class="docutils literal notranslate"><span class="pre">purrr</span></code> function: <code class="docutils literal notranslate"><span class="pre">map</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purrr-map-test-drive"><code class="docutils literal notranslate"><span class="pre">purrr::map</span></code> test drive</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-our-data-frame-had-missing-values">What if our data frame had missing values?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attributions">Attributions</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>